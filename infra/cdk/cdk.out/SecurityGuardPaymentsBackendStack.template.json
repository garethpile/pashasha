{
  "Resources": {
    "CognitoSmsRole3E5A1370": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "cognito-idp.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Description": "Allows Cognito to publish SMS messages via SNS",
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AmazonSNSRole"
              ]
            ]
          }
        ],
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": "sns:Publish",
                  "Effect": "Allow",
                  "Resource": "*"
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "CognitoSmsPublish"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/CognitoSmsRole/Resource"
      }
    },
    "BackendVpcC09D5BB7": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "CidrBlock": "10.0.0.0/16",
        "EnableDnsHostnames": true,
        "EnableDnsSupport": true,
        "InstanceTenancy": "default",
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/Resource"
      }
    },
    "BackendVpcPublicSubnet1Subnet9D3515AA": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": "eu-west-1a",
        "CidrBlock": "10.0.0.0/18",
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "Public"
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Public"
          },
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1/Subnet"
      }
    },
    "BackendVpcPublicSubnet1RouteTableBA4FDE64": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1/RouteTable"
      }
    },
    "BackendVpcPublicSubnet1RouteTableAssociation720D9165": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "BackendVpcPublicSubnet1RouteTableBA4FDE64"
        },
        "SubnetId": {
          "Ref": "BackendVpcPublicSubnet1Subnet9D3515AA"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1/RouteTableAssociation"
      }
    },
    "BackendVpcPublicSubnet1DefaultRouteE5AEA3E8": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "BackendVpcIGW541B5672"
        },
        "RouteTableId": {
          "Ref": "BackendVpcPublicSubnet1RouteTableBA4FDE64"
        }
      },
      "DependsOn": ["BackendVpcVPCGWE6A2470E"],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1/DefaultRoute"
      }
    },
    "BackendVpcPublicSubnet1EIP58477CDB": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Domain": "vpc",
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1/EIP"
      }
    },
    "BackendVpcPublicSubnet1NATGateway86D87B29": {
      "Type": "AWS::EC2::NatGateway",
      "Properties": {
        "AllocationId": {
          "Fn::GetAtt": ["BackendVpcPublicSubnet1EIP58477CDB", "AllocationId"]
        },
        "SubnetId": {
          "Ref": "BackendVpcPublicSubnet1Subnet9D3515AA"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1"
          }
        ]
      },
      "DependsOn": [
        "BackendVpcPublicSubnet1DefaultRouteE5AEA3E8",
        "BackendVpcPublicSubnet1RouteTableAssociation720D9165"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet1/NATGateway"
      }
    },
    "BackendVpcPublicSubnet2Subnet5D82DB54": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": "eu-west-1b",
        "CidrBlock": "10.0.64.0/18",
        "MapPublicIpOnLaunch": true,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "Public"
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Public"
          },
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet2"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet2/Subnet"
      }
    },
    "BackendVpcPublicSubnet2RouteTable8C2AB804": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet2"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet2/RouteTable"
      }
    },
    "BackendVpcPublicSubnet2RouteTableAssociation1D2E03F3": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "BackendVpcPublicSubnet2RouteTable8C2AB804"
        },
        "SubnetId": {
          "Ref": "BackendVpcPublicSubnet2Subnet5D82DB54"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet2/RouteTableAssociation"
      }
    },
    "BackendVpcPublicSubnet2DefaultRoute53B0EE2B": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "BackendVpcIGW541B5672"
        },
        "RouteTableId": {
          "Ref": "BackendVpcPublicSubnet2RouteTable8C2AB804"
        }
      },
      "DependsOn": ["BackendVpcVPCGWE6A2470E"],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PublicSubnet2/DefaultRoute"
      }
    },
    "BackendVpcPrivateSubnet1Subnet911DA327": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": "eu-west-1a",
        "CidrBlock": "10.0.128.0/18",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "Private"
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Private"
          },
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet1"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet1/Subnet"
      }
    },
    "BackendVpcPrivateSubnet1RouteTable50577220": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet1"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet1/RouteTable"
      }
    },
    "BackendVpcPrivateSubnet1RouteTableAssociationFC788464": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "BackendVpcPrivateSubnet1RouteTable50577220"
        },
        "SubnetId": {
          "Ref": "BackendVpcPrivateSubnet1Subnet911DA327"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet1/RouteTableAssociation"
      }
    },
    "BackendVpcPrivateSubnet1DefaultRouteD5FFC862": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "NatGatewayId": {
          "Ref": "BackendVpcPublicSubnet1NATGateway86D87B29"
        },
        "RouteTableId": {
          "Ref": "BackendVpcPrivateSubnet1RouteTable50577220"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet1/DefaultRoute"
      }
    },
    "BackendVpcPrivateSubnet2Subnet7AF7AF1A": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": "eu-west-1b",
        "CidrBlock": "10.0.192.0/18",
        "MapPublicIpOnLaunch": false,
        "Tags": [
          {
            "Key": "aws-cdk:subnet-name",
            "Value": "Private"
          },
          {
            "Key": "aws-cdk:subnet-type",
            "Value": "Private"
          },
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet2"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet2/Subnet"
      }
    },
    "BackendVpcPrivateSubnet2RouteTableBDCAB3B1": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet2"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet2/RouteTable"
      }
    },
    "BackendVpcPrivateSubnet2RouteTableAssociationFCC45200": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "BackendVpcPrivateSubnet2RouteTableBDCAB3B1"
        },
        "SubnetId": {
          "Ref": "BackendVpcPrivateSubnet2Subnet7AF7AF1A"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet2/RouteTableAssociation"
      }
    },
    "BackendVpcPrivateSubnet2DefaultRoute2AF832BC": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "NatGatewayId": {
          "Ref": "BackendVpcPublicSubnet1NATGateway86D87B29"
        },
        "RouteTableId": {
          "Ref": "BackendVpcPrivateSubnet2RouteTableBDCAB3B1"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/PrivateSubnet2/DefaultRoute"
      }
    },
    "BackendVpcIGW541B5672": {
      "Type": "AWS::EC2::InternetGateway",
      "Properties": {
        "Tags": [
          {
            "Key": "Name",
            "Value": "SecurityGuardPaymentsBackendStack/BackendVpc"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/IGW"
      }
    },
    "BackendVpcVPCGWE6A2470E": {
      "Type": "AWS::EC2::VPCGatewayAttachment",
      "Properties": {
        "InternetGatewayId": {
          "Ref": "BackendVpcIGW541B5672"
        },
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendVpc/VPCGW"
      }
    },
    "BackendCluster5086059C": {
      "Type": "AWS::ECS::Cluster",
      "Properties": {
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "enabled"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendCluster/Resource"
      }
    },
    "UserPool6BA7E5F2": {
      "Type": "AWS::Cognito::UserPool",
      "Properties": {
        "AccountRecoverySetting": {
          "RecoveryMechanisms": [
            {
              "Name": "verified_phone_number",
              "Priority": 1
            },
            {
              "Name": "verified_email",
              "Priority": 2
            }
          ]
        },
        "AdminCreateUserConfig": {
          "AllowAdminCreateUserOnly": false
        },
        "AliasAttributes": ["email", "phone_number"],
        "AutoVerifiedAttributes": ["email", "phone_number"],
        "EmailVerificationMessage": "The verification code to your new account is {####}",
        "EmailVerificationSubject": "Verify your new account",
        "Schema": [
          {
            "Mutable": true,
            "Name": "given_name",
            "Required": true
          },
          {
            "Mutable": true,
            "Name": "family_name",
            "Required": true
          },
          {
            "Mutable": true,
            "Name": "email",
            "Required": true
          },
          {
            "Mutable": true,
            "Name": "phone_number",
            "Required": false
          }
        ],
        "SmsConfiguration": {
          "ExternalId": "CognitoSmsRoleExternal",
          "SnsCallerArn": {
            "Fn::GetAtt": ["CognitoSmsRole3E5A1370", "Arn"]
          }
        },
        "SmsVerificationMessage": "The verification code to your new account is {####}",
        "VerificationMessageTemplate": {
          "DefaultEmailOption": "CONFIRM_WITH_CODE",
          "EmailMessage": "The verification code to your new account is {####}",
          "EmailSubject": "Verify your new account",
          "SmsMessage": "The verification code to your new account is {####}"
        }
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/UserPool/Resource"
      }
    },
    "UserPoolWebClient4C9370B0": {
      "Type": "AWS::Cognito::UserPoolClient",
      "Properties": {
        "AllowedOAuthFlows": ["implicit", "code"],
        "AllowedOAuthFlowsUserPoolClient": true,
        "AllowedOAuthScopes": [
          "profile",
          "phone",
          "email",
          "openid",
          "aws.cognito.signin.user.admin"
        ],
        "CallbackURLs": ["https://example.com"],
        "ExplicitAuthFlows": [
          "ALLOW_USER_PASSWORD_AUTH",
          "ALLOW_USER_SRP_AUTH",
          "ALLOW_REFRESH_TOKEN_AUTH"
        ],
        "SupportedIdentityProviders": ["COGNITO"],
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/UserPool/WebClient/Resource"
      }
    },
    "AdministratorsGroup": {
      "Type": "AWS::Cognito::UserPoolGroup",
      "Properties": {
        "GroupName": "Administrators",
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AdministratorsGroup"
      }
    },
    "CustomersGroup": {
      "Type": "AWS::Cognito::UserPoolGroup",
      "Properties": {
        "GroupName": "Customers",
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/CustomersGroup"
      }
    },
    "CivilServantsGroup": {
      "Type": "AWS::Cognito::UserPoolGroup",
      "Properties": {
        "GroupName": "CivilServants",
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/CivilServantsGroup"
      }
    },
    "CustomersTableB554B793": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "customerId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "accountNumber",
            "AttributeType": "S"
          },
          {
            "AttributeName": "familyNameUpper",
            "AttributeType": "S"
          },
          {
            "AttributeName": "emailLower",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "accountNumber",
            "KeySchema": [
              {
                "AttributeName": "accountNumber",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "familyNameUpper",
            "KeySchema": [
              {
                "AttributeName": "familyNameUpper",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "email",
            "KeySchema": [
              {
                "AttributeName": "emailLower",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "customerId",
            "KeyType": "HASH"
          }
        ],
        "TableName": "sgp-customers"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/CustomersTable/Resource"
      }
    },
    "CivilServantsTableC16F2C77": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "civilServantId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "accountNumber",
            "AttributeType": "S"
          },
          {
            "AttributeName": "familyNameUpper",
            "AttributeType": "S"
          },
          {
            "AttributeName": "guardToken",
            "AttributeType": "S"
          },
          {
            "AttributeName": "emailLower",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "accountNumber",
            "KeySchema": [
              {
                "AttributeName": "accountNumber",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "familyNameUpper",
            "KeySchema": [
              {
                "AttributeName": "familyNameUpper",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "guardToken",
            "KeySchema": [
              {
                "AttributeName": "guardToken",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "email",
            "KeySchema": [
              {
                "AttributeName": "emailLower",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "civilServantId",
            "KeyType": "HASH"
          }
        ],
        "TableName": "sgp-civil-servants"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/CivilServantsTable/Resource"
      }
    },
    "PaymentsTable48A42630": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "paymentId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "customerId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "civilServantId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "walletId",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "byCustomer",
            "KeySchema": [
              {
                "AttributeName": "customerId",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "byCivilServant",
            "KeySchema": [
              {
                "AttributeName": "civilServantId",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          },
          {
            "IndexName": "byWallet",
            "KeySchema": [
              {
                "AttributeName": "walletId",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "paymentId",
            "KeyType": "HASH"
          }
        ],
        "TableName": "sgp-payments"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/PaymentsTable/Resource"
      }
    },
    "AccountCounterTable225C6EF1": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "pk",
            "AttributeType": "S"
          },
          {
            "AttributeName": "sk",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "pk",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "sk",
            "KeyType": "RANGE"
          }
        ],
        "TableName": "sgp-account-counters"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountCounterTable/Resource"
      }
    },
    "UserAssetsBucket8B59E294": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "CorsConfiguration": {
          "CorsRules": [
            {
              "AllowedHeaders": ["*"],
              "AllowedMethods": ["GET", "PUT"],
              "AllowedOrigins": ["*"]
            }
          ]
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "Tags": [
          {
            "Key": "aws-cdk:auto-delete-objects",
            "Value": "true"
          }
        ]
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/UserAssetsBucket/Resource"
      }
    },
    "UserAssetsBucketPolicy42427AB7": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "UserAssetsBucket8B59E294"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": ["s3:PutBucketPolicy", "s3:GetBucket*", "s3:List*", "s3:DeleteObject*"],
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::GetAtt": [
                    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092",
                    "Arn"
                  ]
                }
              },
              "Resource": [
                {
                  "Fn::GetAtt": ["UserAssetsBucket8B59E294", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["UserAssetsBucket8B59E294", "Arn"]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/UserAssetsBucket/Policy/Resource"
      }
    },
    "UserAssetsBucketAutoDeleteObjectsCustomResource11BFF435": {
      "Type": "Custom::S3AutoDeleteObjects",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": ["CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F", "Arn"]
        },
        "BucketName": {
          "Ref": "UserAssetsBucket8B59E294"
        }
      },
      "DependsOn": ["UserAssetsBucketPolicy42427AB7"],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/UserAssetsBucket/AutoDeleteObjectsCustomResource/Default"
      }
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ]
        },
        "ManagedPolicyArns": [
          {
            "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role"
      }
    },
    "CustomS3AutoDeleteObjectsCustomResourceProviderHandler9D90184F": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-732439976770-eu-west-1",
          "S3Key": "faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6.zip"
        },
        "Timeout": 900,
        "MemorySize": 128,
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": ["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092", "Arn"]
        },
        "Runtime": "nodejs20.x",
        "Description": {
          "Fn::Join": [
            "",
            [
              "Lambda function for auto-deleting objects in ",
              {
                "Ref": "UserAssetsBucket8B59E294"
              },
              " S3 bucket."
            ]
          ]
        }
      },
      "DependsOn": ["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092"],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler",
        "aws:asset:path": "asset.faa95a81ae7d7373f3e1f242268f904eb748d8d0fdd306e8a6fe515a1905a7d6",
        "aws:asset:property": "Code"
      }
    },
    "BackendLogGroupDA10F1B2": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/security-guard-payments/backend",
        "RetentionInDays": 30
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendLogGroup/Resource"
      }
    },
    "AccountWorkflowLogs4F77612E": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/security-guard-payments/account-workflow",
        "RetentionInDays": 30
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowLogs/Resource"
      }
    },
    "SignupNotificationsTopicB32F2A94": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "DisplayName": "Signup Notifications"
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/SignupNotificationsTopic/Resource"
      }
    },
    "AccountWorkflowLambdaServiceRole4DD86BD4": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowLambda/ServiceRole/Resource"
      }
    },
    "AccountWorkflowLambdaServiceRoleDefaultPolicy1342C6AB": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "cognito-idp:AdminCreateUser",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": ["UserPool6BA7E5F2", "Arn"]
              }
            },
            {
              "Action": "cognito-idp:AdminAddUserToGroup",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": ["UserPool6BA7E5F2", "Arn"]
              }
            },
            {
              "Action": "cognito-idp:AdminSetUserPassword",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": ["UserPool6BA7E5F2", "Arn"]
              }
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["CustomersTableB554B793", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["CustomersTableB554B793", "Arn"]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["CivilServantsTableC16F2C77", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["CivilServantsTableC16F2C77", "Arn"]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["AccountCounterTable225C6EF1", "Arn"]
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            },
            {
              "Action": ["secretsmanager:GetSecretValue", "secretsmanager:DescribeSecret"],
              "Effect": "Allow",
              "Resource": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K"
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "SignupNotificationsTopicB32F2A94"
              }
            },
            {
              "Action": [
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": ["UserAssetsBucket8B59E294", "Arn"]
                    },
                    "/*"
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "AccountWorkflowLambdaServiceRoleDefaultPolicy1342C6AB",
        "Roles": [
          {
            "Ref": "AccountWorkflowLambdaServiceRole4DD86BD4"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowLambda/ServiceRole/DefaultPolicy/Resource"
      }
    },
    "AccountWorkflowLambda45EAA938": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-732439976770-eu-west-1",
          "S3Key": "2c568af9f2053e3919dc0bbbd7a4e4ba4e058b7e1fa21e8a825d0e7e30b7afb2.zip"
        },
        "Environment": {
          "Variables": {
            "USER_POOL_ID": {
              "Ref": "UserPool6BA7E5F2"
            },
            "CUSTOMERS_TABLE_NAME": {
              "Ref": "CustomersTableB554B793"
            },
            "CIVIL_SERVANTS_TABLE_NAME": {
              "Ref": "CivilServantsTableC16F2C77"
            },
            "ECLIPSE_SECRET_ARN": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K",
            "SIGNUP_TOPIC_ARN": {
              "Ref": "SignupNotificationsTopicB32F2A94"
            },
            "COUNTER_TABLE_NAME": {
              "Ref": "AccountCounterTable225C6EF1"
            },
            "USER_ASSETS_BUCKET": {
              "Ref": "UserAssetsBucket8B59E294"
            },
            "GUARD_PORTAL_BASE_URL": "https://main.d2vxflzymkt19g.amplifyapp.com"
          }
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": ["AccountWorkflowLambdaServiceRole4DD86BD4", "Arn"]
        },
        "Runtime": "nodejs20.x"
      },
      "DependsOn": [
        "AccountWorkflowLambdaServiceRoleDefaultPolicy1342C6AB",
        "AccountWorkflowLambdaServiceRole4DD86BD4"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowLambda/Resource",
        "aws:asset:path": "asset.2c568af9f2053e3919dc0bbbd7a4e4ba4e058b7e1fa21e8a825d0e7e30b7afb2",
        "aws:asset:is-bundled": true,
        "aws:asset:property": "Code"
      }
    },
    "AccountWorkflowNotifierServiceRole01B1B6E3": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowNotifier/ServiceRole/Resource"
      }
    },
    "AccountWorkflowNotifierServiceRoleDefaultPolicy72BF748E": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "SignupNotificationsTopicB32F2A94"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "AccountWorkflowNotifierServiceRoleDefaultPolicy72BF748E",
        "Roles": [
          {
            "Ref": "AccountWorkflowNotifierServiceRole01B1B6E3"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowNotifier/ServiceRole/DefaultPolicy/Resource"
      }
    },
    "AccountWorkflowNotifierCF707EBD": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-732439976770-eu-west-1",
          "S3Key": "3c506014f9fb114a06b94ce3428c3dee16778fd37f03c492bad51dd1cf8dcabc.zip"
        },
        "Environment": {
          "Variables": {
            "SIGNUP_TOPIC_ARN": {
              "Ref": "SignupNotificationsTopicB32F2A94"
            }
          }
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": ["AccountWorkflowNotifierServiceRole01B1B6E3", "Arn"]
        },
        "Runtime": "nodejs20.x"
      },
      "DependsOn": [
        "AccountWorkflowNotifierServiceRoleDefaultPolicy72BF748E",
        "AccountWorkflowNotifierServiceRole01B1B6E3"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountWorkflowNotifier/Resource",
        "aws:asset:path": "asset.3c506014f9fb114a06b94ce3428c3dee16778fd37f03c492bad51dd1cf8dcabc",
        "aws:asset:is-bundled": true,
        "aws:asset:property": "Code"
      }
    },
    "AccountProvisioningStateMachineV2RoleD36AA1BD": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "states.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountProvisioningStateMachineV2/Role/Resource"
      }
    },
    "AccountProvisioningStateMachineV2RoleDefaultPolicyDDFB4BD4": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["AccountWorkflowNotifierCF707EBD", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["AccountWorkflowNotifierCF707EBD", "Arn"]
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "logs:CreateLogDelivery",
                "logs:GetLogDelivery",
                "logs:UpdateLogDelivery",
                "logs:DeleteLogDelivery",
                "logs:ListLogDeliveries",
                "logs:PutResourcePolicy",
                "logs:DescribeResourcePolicies",
                "logs:DescribeLogGroups"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
                "xray:GetSamplingRules",
                "xray:GetSamplingTargets"
              ],
              "Effect": "Allow",
              "Resource": "*"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "AccountProvisioningStateMachineV2RoleDefaultPolicyDDFB4BD4",
        "Roles": [
          {
            "Ref": "AccountProvisioningStateMachineV2RoleD36AA1BD"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountProvisioningStateMachineV2/Role/DefaultPolicy/Resource"
      }
    },
    "AccountProvisioningStateMachineV2063EE88C": {
      "Type": "AWS::StepFunctions::StateMachine",
      "Properties": {
        "DefinitionString": {
          "Fn::Join": [
            "",
            [
              "{\"StartAt\":\"CreateCognitoUser\",\"States\":{\"CreateCognitoUser\":{\"Next\":\"CreateProfileRecord\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"NotifyWorkflowFailure\"}],\"Type\":\"Task\",\"ResultPath\":\"$\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
              },
              "\",\"Parameters\":{\"state\":{\"type\":0,\"value.$\":\"$\"},\"step\":\"createCognito\"}},\"CreateProfileRecord\":{\"Next\":\"CreateEclipseCustomer\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"NotifyWorkflowFailure\"}],\"Type\":\"Task\",\"ResultPath\":\"$\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
              },
              "\",\"Parameters\":{\"state\":{\"type\":0,\"value.$\":\"$\"},\"step\":\"createProfile\"}},\"CreateEclipseCustomer\":{\"Next\":\"CreateEclipseWallet\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"NotifyWorkflowFailure\"}],\"Type\":\"Task\",\"ResultPath\":\"$\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
              },
              "\",\"Parameters\":{\"state\":{\"type\":0,\"value.$\":\"$\"},\"step\":\"createEclipseCustomer\"}},\"CreateEclipseWallet\":{\"Next\":\"EnsureGuardAssets\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"NotifyWorkflowFailure\"}],\"Type\":\"Task\",\"ResultPath\":\"$\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
              },
              "\",\"Parameters\":{\"state\":{\"type\":0,\"value.$\":\"$\"},\"step\":\"createEclipseWallet\"}},\"EnsureGuardAssets\":{\"Next\":\"UpdateProfileWithEclipseIds\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"NotifyWorkflowFailure\"}],\"Type\":\"Task\",\"ResultPath\":\"$\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
              },
              "\",\"Parameters\":{\"state\":{\"type\":0,\"value.$\":\"$\"},\"step\":\"ensureGuardAssets\"}},\"UpdateProfileWithEclipseIds\":{\"Next\":\"NotifyWorkflowSuccess\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":\"$.error\",\"Next\":\"NotifyWorkflowFailure\"}],\"Type\":\"Task\",\"ResultPath\":\"$\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowLambda45EAA938", "Arn"]
              },
              "\",\"Parameters\":{\"state\":{\"type\":0,\"value.$\":\"$\"},\"step\":\"updateProfile\"}},\"NotifyWorkflowSuccess\":{\"Next\":\"AccountWorkflowSucceeded\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":\"$.notification\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowNotifierCF707EBD", "Arn"]
              },
              "\",\"Parameters\":{\"status\":\"success\",\"message.$\":\"States.Format('Account provisioning succeeded for {}', $.type)\",\"context\":{\"type\":1,\"value\":{\"type.$\":\"$.type\",\"profileId.$\":\"$.profileId\",\"cognitoUsername.$\":\"$.cognitoUsername\",\"cognitoSub.$\":\"$.cognitoSub\",\"eclipseCustomerId.$\":\"$.eclipseCustomerId\",\"eclipseWalletId.$\":\"$.eclipseWalletId\"}}}},\"AccountWorkflowSucceeded\":{\"Type\":\"Succeed\"},\"NotifyWorkflowFailure\":{\"Next\":\"AccountWorkflowFailed\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"ResultPath\":\"$.notification\",\"Resource\":\"",
              {
                "Fn::GetAtt": ["AccountWorkflowNotifierCF707EBD", "Arn"]
              },
              "\",\"Parameters\":{\"status\":\"failure\",\"message.$\":\"$.error.Cause\",\"context\":{\"type\":0,\"value.$\":\"$.error\"}}},\"AccountWorkflowFailed\":{\"Type\":\"Fail\",\"Cause\":\"Account provisioning failed\"}}}"
            ]
          ]
        },
        "LoggingConfiguration": {
          "Destinations": [
            {
              "CloudWatchLogsLogGroup": {
                "LogGroupArn": {
                  "Fn::GetAtt": ["AccountWorkflowLogs4F77612E", "Arn"]
                }
              }
            }
          ],
          "Level": "ALL"
        },
        "RoleArn": {
          "Fn::GetAtt": ["AccountProvisioningStateMachineV2RoleD36AA1BD", "Arn"]
        },
        "TracingConfiguration": {
          "Enabled": true
        }
      },
      "DependsOn": [
        "AccountProvisioningStateMachineV2RoleDefaultPolicyDDFB4BD4",
        "AccountProvisioningStateMachineV2RoleD36AA1BD"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/AccountProvisioningStateMachineV2/Resource"
      }
    },
    "BackendFargateServiceLBA38260FE": {
      "Type": "AWS::ElasticLoadBalancingV2::LoadBalancer",
      "Properties": {
        "LoadBalancerAttributes": [
          {
            "Key": "deletion_protection.enabled",
            "Value": "false"
          }
        ],
        "Scheme": "internet-facing",
        "SecurityGroups": [
          {
            "Fn::GetAtt": ["BackendFargateServiceLBSecurityGroup1849D2B2", "GroupId"]
          }
        ],
        "Subnets": [
          {
            "Ref": "BackendVpcPublicSubnet1Subnet9D3515AA"
          },
          {
            "Ref": "BackendVpcPublicSubnet2Subnet5D82DB54"
          }
        ],
        "Type": "application"
      },
      "DependsOn": [
        "BackendVpcPublicSubnet1DefaultRouteE5AEA3E8",
        "BackendVpcPublicSubnet1RouteTableAssociation720D9165",
        "BackendVpcPublicSubnet2DefaultRoute53B0EE2B",
        "BackendVpcPublicSubnet2RouteTableAssociation1D2E03F3"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/LB/Resource"
      }
    },
    "BackendFargateServiceLBSecurityGroup1849D2B2": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Automatically created Security Group for ELB SecurityGuardPaymentsBackendStackBackendFargateServiceLBEDE36FD8",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow from anyone on port 80",
            "FromPort": 80,
            "IpProtocol": "tcp",
            "ToPort": 80
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/LB/SecurityGroup/Resource"
      }
    },
    "BackendFargateServiceLBSecurityGrouptoSecurityGuardPaymentsBackendStackBackendFargateServiceSecurityGroup64B5E8C2400049D4330C": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "Description": "Load balancer to target",
        "DestinationSecurityGroupId": {
          "Fn::GetAtt": ["BackendFargateServiceSecurityGroup52160937", "GroupId"]
        },
        "FromPort": 4000,
        "GroupId": {
          "Fn::GetAtt": ["BackendFargateServiceLBSecurityGroup1849D2B2", "GroupId"]
        },
        "IpProtocol": "tcp",
        "ToPort": 4000
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/LB/SecurityGroup/to SecurityGuardPaymentsBackendStackBackendFargateServiceSecurityGroup64B5E8C2:4000"
      }
    },
    "BackendFargateServiceLBPublicListener36B53DB0": {
      "Type": "AWS::ElasticLoadBalancingV2::Listener",
      "Properties": {
        "DefaultActions": [
          {
            "TargetGroupArn": {
              "Ref": "BackendFargateServiceLBPublicListenerECSGroup56AB4EF1"
            },
            "Type": "forward"
          }
        ],
        "LoadBalancerArn": {
          "Ref": "BackendFargateServiceLBA38260FE"
        },
        "Port": 80,
        "Protocol": "HTTP"
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/LB/PublicListener/Resource"
      }
    },
    "BackendFargateServiceLBPublicListenerECSGroup56AB4EF1": {
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "HealthCheckIntervalSeconds": 30,
        "HealthCheckPath": "/health",
        "HealthCheckTimeoutSeconds": 5,
        "Matcher": {
          "HttpCode": "200"
        },
        "Port": 80,
        "Protocol": "HTTP",
        "TargetGroupAttributes": [
          {
            "Key": "stickiness.enabled",
            "Value": "false"
          }
        ],
        "TargetType": "ip",
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/LB/PublicListener/ECSGroup/Resource"
      }
    },
    "BackendFargateServiceTaskDefTaskRole75B7E3C0": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/TaskDef/TaskRole/Resource"
      }
    },
    "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["CustomersTableB554B793", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["CustomersTableB554B793", "Arn"]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["CivilServantsTableC16F2C77", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["CivilServantsTableC16F2C77", "Arn"]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["PaymentsTable48A42630", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["PaymentsTable48A42630", "Arn"]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["UserAssetsBucket8B59E294", "Arn"]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": ["UserAssetsBucket8B59E294", "Arn"]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:Query",
                "dynamodb:GetItem",
                "dynamodb:Scan",
                "dynamodb:ConditionCheckItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": ["AccountCounterTable225C6EF1", "Arn"]
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            },
            {
              "Action": "sns:Publish",
              "Effect": "Allow",
              "Resource": {
                "Ref": "SignupNotificationsTopicB32F2A94"
              }
            },
            {
              "Action": "states:StartExecution",
              "Effect": "Allow",
              "Resource": {
                "Ref": "AccountProvisioningStateMachineV2063EE88C"
              }
            },
            {
              "Action": [
                "cognito-idp:AdminCreateUser",
                "cognito-idp:AdminDeleteUser",
                "cognito-idp:AdminAddUserToGroup",
                "cognito-idp:AdminUpdateUserAttributes",
                "cognito-idp:ListUsersInGroup"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": ["UserPool6BA7E5F2", "Arn"]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD",
        "Roles": [
          {
            "Ref": "BackendFargateServiceTaskDefTaskRole75B7E3C0"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/TaskDef/TaskRole/DefaultPolicy/Resource"
      }
    },
    "BackendFargateServiceTaskDef2265C2A7": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "ContainerDefinitions": [
          {
            "Environment": [
              {
                "Name": "NODE_ENV",
                "Value": "production"
              },
              {
                "Name": "PORT",
                "Value": "4000"
              },
              {
                "Name": "USER_POOL_ID",
                "Value": {
                  "Ref": "UserPool6BA7E5F2"
                }
              },
              {
                "Name": "USER_POOL_CLIENT_ID",
                "Value": {
                  "Ref": "UserPoolWebClient4C9370B0"
                }
              },
              {
                "Name": "CUSTOMERS_TABLE_NAME",
                "Value": {
                  "Ref": "CustomersTableB554B793"
                }
              },
              {
                "Name": "CIVIL_SERVANTS_TABLE_NAME",
                "Value": {
                  "Ref": "CivilServantsTableC16F2C77"
                }
              },
              {
                "Name": "PAYMENTS_TABLE_NAME",
                "Value": {
                  "Ref": "PaymentsTable48A42630"
                }
              },
              {
                "Name": "USER_ASSETS_BUCKET",
                "Value": {
                  "Ref": "UserAssetsBucket8B59E294"
                }
              },
              {
                "Name": "COUNTER_TABLE_NAME",
                "Value": {
                  "Ref": "AccountCounterTable225C6EF1"
                }
              },
              {
                "Name": "GUARD_PORTAL_BASE_URL",
                "Value": "https://main.d2vxflzymkt19g.amplifyapp.com"
              },
              {
                "Name": "SIGNUP_SNS_TOPIC_ARN",
                "Value": {
                  "Ref": "SignupNotificationsTopicB32F2A94"
                }
              },
              {
                "Name": "ACCOUNT_WORKFLOW_ARN",
                "Value": {
                  "Ref": "AccountProvisioningStateMachineV2063EE88C"
                }
              },
              {
                "Name": "TENANT_WALLET_ID",
                "Value": "2550018"
              }
            ],
            "Essential": true,
            "Image": {
              "Fn::Sub": "732439976770.dkr.ecr.eu-west-1.${AWS::URLSuffix}/cdk-hnb659fds-container-assets-732439976770-eu-west-1:ab984033ce00965fd9a51ef0b1efd0a71727b0a9fd729399797173fe07dd2dfd"
            },
            "LogConfiguration": {
              "LogDriver": "awslogs",
              "Options": {
                "awslogs-group": {
                  "Ref": "BackendLogGroupDA10F1B2"
                },
                "awslogs-stream-prefix": "backend",
                "awslogs-region": "eu-west-1"
              }
            },
            "Name": "web",
            "PortMappings": [
              {
                "ContainerPort": 4000,
                "Protocol": "tcp"
              }
            ],
            "Secrets": [
              {
                "Name": "ECLIPSE_API_BASE",
                "ValueFrom": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K:ECLIPSE_API_BASE::"
              },
              {
                "Name": "ECLIPSE_TENANT_ID",
                "ValueFrom": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K:ECLIPSE_TENANT_ID::"
              },
              {
                "Name": "ECLIPSE_TENANT_IDENTITY",
                "ValueFrom": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K:ECLIPSE_TENANT_IDENTITY::"
              },
              {
                "Name": "ECLIPSE_TENANT_PASSWORD",
                "ValueFrom": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K:ECLIPSE_TENANT_PASSWORD::"
              },
              {
                "Name": "ECLIPSE_CALLBACK_BASE",
                "ValueFrom": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K:ECLIPSE_CALLBACK_BASE::"
              },
              {
                "Name": "ECLIPSE_WEBHOOK_SECRET",
                "ValueFrom": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K:ECLIPSE_WEBHOOK_SECRET::"
              }
            ]
          }
        ],
        "Cpu": "1024",
        "ExecutionRoleArn": {
          "Fn::GetAtt": ["BackendFargateServiceTaskDefExecutionRoleAEEBC172", "Arn"]
        },
        "Family": "SecurityGuardPaymentsBackendStackBackendFargateServiceTaskDef8BD4B29A",
        "Memory": "4096",
        "NetworkMode": "awsvpc",
        "RequiresCompatibilities": ["FARGATE"],
        "TaskRoleArn": {
          "Fn::GetAtt": ["BackendFargateServiceTaskDefTaskRole75B7E3C0", "Arn"]
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/TaskDef/Resource"
      }
    },
    "BackendFargateServiceTaskDefExecutionRoleAEEBC172": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "ecs-tasks.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/TaskDef/ExecutionRole/Resource"
      }
    },
    "BackendFargateServiceTaskDefExecutionRoleDefaultPolicyF7D40C73": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ecr:eu-west-1:732439976770:repository/cdk-hnb659fds-container-assets-732439976770-eu-west-1"
                  ]
                ]
              }
            },
            {
              "Action": "ecr:GetAuthorizationToken",
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": ["logs:CreateLogStream", "logs:PutLogEvents"],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": ["BackendLogGroupDA10F1B2", "Arn"]
              }
            },
            {
              "Action": ["secretsmanager:GetSecretValue", "secretsmanager:DescribeSecret"],
              "Effect": "Allow",
              "Resource": "arn:aws:secretsmanager:eu-west-1:732439976770:secret:prod/pashashapay/eclipse-GLKO1K"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "BackendFargateServiceTaskDefExecutionRoleDefaultPolicyF7D40C73",
        "Roles": [
          {
            "Ref": "BackendFargateServiceTaskDefExecutionRoleAEEBC172"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/TaskDef/ExecutionRole/DefaultPolicy/Resource"
      }
    },
    "BackendFargateService29076574": {
      "Type": "AWS::ECS::Service",
      "Properties": {
        "Cluster": {
          "Ref": "BackendCluster5086059C"
        },
        "DeploymentConfiguration": {
          "Alarms": {
            "AlarmNames": [],
            "Enable": false,
            "Rollback": false
          },
          "MaximumPercent": 200,
          "MinimumHealthyPercent": 50
        },
        "DesiredCount": 1,
        "EnableECSManagedTags": false,
        "HealthCheckGracePeriodSeconds": 60,
        "LaunchType": "FARGATE",
        "LoadBalancers": [
          {
            "ContainerName": "web",
            "ContainerPort": 4000,
            "TargetGroupArn": {
              "Ref": "BackendFargateServiceLBPublicListenerECSGroup56AB4EF1"
            }
          }
        ],
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "AssignPublicIp": "DISABLED",
            "SecurityGroups": [
              {
                "Fn::GetAtt": ["BackendFargateServiceSecurityGroup52160937", "GroupId"]
              }
            ],
            "Subnets": [
              {
                "Ref": "BackendVpcPrivateSubnet1Subnet911DA327"
              },
              {
                "Ref": "BackendVpcPrivateSubnet2Subnet7AF7AF1A"
              }
            ]
          }
        },
        "TaskDefinition": {
          "Ref": "BackendFargateServiceTaskDef2265C2A7"
        }
      },
      "DependsOn": [
        "BackendFargateServiceLBPublicListenerECSGroup56AB4EF1",
        "BackendFargateServiceLBPublicListener36B53DB0",
        "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD",
        "BackendFargateServiceTaskDefTaskRole75B7E3C0"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/Service/Service"
      }
    },
    "BackendFargateServiceSecurityGroup52160937": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "SecurityGuardPaymentsBackendStack/BackendFargateService/Service/SecurityGroup",
        "SecurityGroupEgress": [
          {
            "CidrIp": "0.0.0.0/0",
            "Description": "Allow all outbound traffic by default",
            "IpProtocol": "-1"
          }
        ],
        "VpcId": {
          "Ref": "BackendVpcC09D5BB7"
        }
      },
      "DependsOn": [
        "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD",
        "BackendFargateServiceTaskDefTaskRole75B7E3C0"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/Service/SecurityGroup/Resource"
      }
    },
    "BackendFargateServiceSecurityGroupfromSecurityGuardPaymentsBackendStackBackendFargateServiceLBSecurityGroup2CA839214000ADAB93F7": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "Description": "Load balancer to target",
        "FromPort": 4000,
        "GroupId": {
          "Fn::GetAtt": ["BackendFargateServiceSecurityGroup52160937", "GroupId"]
        },
        "IpProtocol": "tcp",
        "SourceSecurityGroupId": {
          "Fn::GetAtt": ["BackendFargateServiceLBSecurityGroup1849D2B2", "GroupId"]
        },
        "ToPort": 4000
      },
      "DependsOn": [
        "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD",
        "BackendFargateServiceTaskDefTaskRole75B7E3C0"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/Service/SecurityGroup/from SecurityGuardPaymentsBackendStackBackendFargateServiceLBSecurityGroup2CA83921:4000"
      }
    },
    "BackendFargateServiceTaskCountTarget19FACCD0": {
      "Type": "AWS::ApplicationAutoScaling::ScalableTarget",
      "Properties": {
        "MaxCapacity": 8,
        "MinCapacity": 2,
        "ResourceId": {
          "Fn::Join": [
            "",
            [
              "service/",
              {
                "Ref": "BackendCluster5086059C"
              },
              "/",
              {
                "Fn::GetAtt": ["BackendFargateService29076574", "Name"]
              }
            ]
          ]
        },
        "RoleARN": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":iam::732439976770:role/aws-service-role/ecs.application-autoscaling.amazonaws.com/AWSServiceRoleForApplicationAutoScaling_ECSService"
            ]
          ]
        },
        "ScalableDimension": "ecs:service:DesiredCount",
        "ServiceNamespace": "ecs"
      },
      "DependsOn": [
        "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD",
        "BackendFargateServiceTaskDefTaskRole75B7E3C0"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/Service/TaskCount/Target/Resource"
      }
    },
    "BackendFargateServiceTaskCountTargetCpuScalingBEA95DD4": {
      "Type": "AWS::ApplicationAutoScaling::ScalingPolicy",
      "Properties": {
        "PolicyName": "SecurityGuardPaymentsBackendStackBackendFargateServiceTaskCountTargetCpuScalingE4B8D26C",
        "PolicyType": "TargetTrackingScaling",
        "ScalingTargetId": {
          "Ref": "BackendFargateServiceTaskCountTarget19FACCD0"
        },
        "TargetTrackingScalingPolicyConfiguration": {
          "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ECSServiceAverageCPUUtilization"
          },
          "ScaleInCooldown": 60,
          "ScaleOutCooldown": 30,
          "TargetValue": 55
        }
      },
      "DependsOn": [
        "BackendFargateServiceTaskDefTaskRoleDefaultPolicy083DCFFD",
        "BackendFargateServiceTaskDefTaskRole75B7E3C0"
      ],
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendFargateService/Service/TaskCount/Target/CpuScaling/Resource"
      }
    },
    "BackendDistribution025C1152": {
      "Type": "AWS::CloudFront::Distribution",
      "Properties": {
        "DistributionConfig": {
          "DefaultCacheBehavior": {
            "AllowedMethods": ["GET", "HEAD", "OPTIONS", "PUT", "PATCH", "POST", "DELETE"],
            "CachePolicyId": "4135ea2d-6df8-44a3-9df3-4b5a84be39ad",
            "Compress": true,
            "OriginRequestPolicyId": "216adef6-5c7f-47e4-b989-5492eafa07d3",
            "TargetOriginId": "SecurityGuardPaymentsBackendStackBackendDistributionOrigin17F178CC9",
            "ViewerProtocolPolicy": "redirect-to-https"
          },
          "Enabled": true,
          "HttpVersion": "http2",
          "IPV6Enabled": true,
          "Origins": [
            {
              "CustomOriginConfig": {
                "OriginProtocolPolicy": "http-only",
                "OriginSSLProtocols": ["TLSv1.2"]
              },
              "DomainName": {
                "Fn::GetAtt": ["BackendFargateServiceLBA38260FE", "DNSName"]
              },
              "Id": "SecurityGuardPaymentsBackendStackBackendDistributionOrigin17F178CC9"
            }
          ]
        }
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/BackendDistribution/Resource"
      }
    },
    "CDKMetadata": {
      "Type": "AWS::CDK::Metadata",
      "Properties": {
        "Analytics": "v2:deflate64:H4sIAAAAAAAA/31UTW/bMAz9Lbs72pZuwK5p0hYBss5Isl4DWWY8JbZo6MNFYPi/j5Ls2GmLnvhIkbL4+Og5+/7zF/v2hb+amcjPs1JmrN1ZLs4JhQ6t5BVrt1hCsjyqYFMspbh4N6IuATFn7UstfOwlXSapy+hg5zIF1sdGtEVnYc+zeF2Mj7GFMSgktxLVNdmDh3XqzTO3T9zCK78kqZYNwfHitbKgCQ8J8SW9t7DUz78KlE12IJyW9vKk0dXhDZ8GHgoNxrwLr1WI+84Na5elM/R1nzXAR64L7rsy5xUcpZJDT28jqCyXCvQk1tfuQDdSRJ56uBO89Dz5S5bolO0SgQWVIWv/GtApYunzr3gAy1L65idH7yOhsS7JL4pXmJMIrmMKoEvMHWvvnThHwnsUzSiJGz8699xQdYkFUbXB4kr0gOlmRUd7rGVQUABUwKss5weFOZwMew7m0SkRODJ3B24MWMMW3vTJjKrHFAv1sXfMwRJlhm1C2lo1eIbbBNK8EwIgJ/plmdACWPhNoqHZhAlM/DD1Q82tVxw9oK6p2SDaDfL8nkakBORvpgglN1aKkjKykCFV0dDWfFytIz8Tf5on6eWqzxnw5HxPX6ZFGGieuP7leiBuhTQcva54AZFDOmNbqNGQnvTFTy3h463cWTSkP3o3cXUVor87EHQbiWav6TdCBbtYN6rkJkAiLtHlR027wNoVdaRl5oaFmfpdl2zBoNN+LWjRsBpd+l18fJRqbGQOOjQUOqVhFvR1X/PH2drRGnmVsZP52sx/sDn9DU9GypmmDZMVsG20/wFvVQmUKgUAAA=="
      },
      "Metadata": {
        "aws:cdk:path": "SecurityGuardPaymentsBackendStack/CDKMetadata/Default"
      }
    }
  },
  "Outputs": {
    "BackendFargateServiceLoadBalancerDNS912E557F": {
      "Value": {
        "Fn::GetAtt": ["BackendFargateServiceLBA38260FE", "DNSName"]
      }
    },
    "BackendFargateServiceServiceURL180FC193": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": ["BackendFargateServiceLBA38260FE", "DNSName"]
            }
          ]
        ]
      }
    },
    "BackendLoadBalancerDns": {
      "Value": {
        "Fn::GetAtt": ["BackendFargateServiceLBA38260FE", "DNSName"]
      },
      "Export": {
        "Name": "SecurityGuardPaymentsBackendAlbDns"
      }
    },
    "BackendServiceSecurityGroup": {
      "Value": {
        "Fn::GetAtt": ["BackendFargateServiceSecurityGroup52160937", "GroupId"]
      }
    },
    "BackendListenerArn": {
      "Value": {
        "Ref": "BackendFargateServiceLBPublicListener36B53DB0"
      }
    },
    "BackendApiEndpoint": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "http://",
            {
              "Fn::GetAtt": ["BackendFargateServiceLBA38260FE", "DNSName"]
            }
          ]
        ]
      }
    },
    "BackendSecureApiEndpoint": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": ["BackendDistribution025C1152", "DomainName"]
            }
          ]
        ]
      }
    },
    "BackendCloudFrontDomain": {
      "Value": {
        "Fn::GetAtt": ["BackendDistribution025C1152", "DomainName"]
      }
    },
    "UserPoolId": {
      "Value": {
        "Ref": "UserPool6BA7E5F2"
      }
    },
    "UserPoolClientId": {
      "Value": {
        "Ref": "UserPoolWebClient4C9370B0"
      }
    },
    "CustomersTableName": {
      "Value": {
        "Ref": "CustomersTableB554B793"
      }
    },
    "CivilServantsTableName": {
      "Value": {
        "Ref": "CivilServantsTableC16F2C77"
      }
    },
    "PaymentsTableName": {
      "Value": {
        "Ref": "PaymentsTable48A42630"
      }
    },
    "UserAssetsBucketName": {
      "Value": {
        "Ref": "UserAssetsBucket8B59E294"
      }
    },
    "AccountCounterTableName": {
      "Value": {
        "Ref": "AccountCounterTable225C6EF1"
      }
    },
    "ExportsOutputFnGetAttBackendDistribution025C1152DomainNameAA03E149": {
      "Value": {
        "Fn::GetAtt": ["BackendDistribution025C1152", "DomainName"]
      },
      "Export": {
        "Name": "SecurityGuardPaymentsBackendStack:ExportsOutputFnGetAttBackendDistribution025C1152DomainNameAA03E149"
      }
    },
    "ExportsOutputFnGetAttBackendFargateServiceLBA38260FEDNSNameC594C614": {
      "Value": {
        "Fn::GetAtt": ["BackendFargateServiceLBA38260FE", "DNSName"]
      },
      "Export": {
        "Name": "SecurityGuardPaymentsBackendStack:ExportsOutputFnGetAttBackendFargateServiceLBA38260FEDNSNameC594C614"
      }
    },
    "ExportsOutputRefUserPool6BA7E5F296FD7236": {
      "Value": {
        "Ref": "UserPool6BA7E5F2"
      },
      "Export": {
        "Name": "SecurityGuardPaymentsBackendStack:ExportsOutputRefUserPool6BA7E5F296FD7236"
      }
    },
    "ExportsOutputRefUserPoolWebClient4C9370B02E2C9FF9": {
      "Value": {
        "Ref": "UserPoolWebClient4C9370B0"
      },
      "Export": {
        "Name": "SecurityGuardPaymentsBackendStack:ExportsOutputRefUserPoolWebClient4C9370B02E2C9FF9"
      }
    }
  },
  "Parameters": {
    "BootstrapVersion": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
    }
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  ["1", "2", "3", "4", "5"],
                  {
                    "Ref": "BootstrapVersion"
                  }
                ]
              }
            ]
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
        }
      ]
    }
  }
}
